{% extends "base.html" %}
{% block title %}Dashboard - Brutal Crypto{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

<div class="dashboard-container">

  <!-- Sidebar -->
  <aside class="dashboard-sidebar">
    <div class="sidebar-logo">
      <h2>Brutal Crypto</h2>
    </div>
    <ul class="sidebar-menu">
      <li><a href="{{ url_for('dashboard') }}" class="active">Dashboard</a></li>
      <li><a href="{{ url_for('profile') }}">Perfil</a></li>
      {% if current_user.is_admin %}
       <li><a href="{{ url_for('admin_index') }}">Painel Admin</a></li>
      {% endif %}
      <li><a href="{{ url_for('logout') }}">Sair</a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="dashboard-main">

    <!-- Top Cards -->
    <div class="cards-grid">
      <div class="card card-red">
        <h3>Saldo Total</h3>
        <p>R$ {{ total_balance }}</p>
      </div>
      <div class="card card-white">
        <h3>Lucro/Perda</h3>
        <p>R$ {{ user.crypto_balance if user.crypto_balance else 0.0 }}</p>
      </div>
      <div class="card card-red">
        <h3>Criptomoedas</h3>
        <p>{{ coins|length }}</p>
      </div>
    </div>

    <!-- Market Actions -->
    <div class="market-actions">
    <div class="card-action">
        <a href="{{ url_for('buy_crypto') }}" class="btn btn-red btn-action">
            Comprar
        </a>
        <p>Escolha a moeda e compre instantaneamente</p>
    </div>
    <div class="card-action">
        <a href="{{ url_for('sell_crypto') }}" class="btn btn-red btn-action">
            Vender
        </a>
        <p>Venda suas moedas rapidamente</p>
    </div>
</div>

    <!-- Recent Transactions -->
    <div class="transactions-section">
      <h3>Transações Recentes</h3>
      <table class="transactions-table">
        <thead>
          <tr>
            <th>Data</th>
            <th>Moeda</th>
            <th>Tipo</th>
            <th>Valor</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for tx in recent_txs %}
          <tr>
            <td>{{ tx.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
            <td>{{ tx.extra.split(' ')[1] if tx.extra else 'N/A' }}</td>
            <td>{{ tx.type }}</td>
            <td>R$ {{ "%.2f"|format(tx.amount) }}</td>
            <td>{{ tx.status }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Music Player -->
    <div class="music-player">
      <h4>Música do Dashboard</h4>
      <audio controls autoplay loop>
        <source src="{{ url_for('static', filename='goosebumps.mp3') }}" type="audio/mpeg">
        Seu navegador não suporta o elemento de áudio.
      </audio>
    </div>

  </main>

</div>

<style>
/* ===== DASHBOARD STYLES ===== */
.dashboard-container {
  display: flex;
  min-height: 100vh;
  background-color: #fff;
  color: #333;
  font-family: 'Segoe UI', sans-serif;
}

/* Sidebar */
.dashboard-sidebar {
  width: 250px;
  background-color: #ff3b3b;
  color: #fff;
  display: flex;
  flex-direction: column;
  padding: 20px;
}
.sidebar-logo h2 {
  text-align: center;
  margin-bottom: 30px;
}
.sidebar-menu {
  list-style: none;
  padding: 0;
}
.sidebar-menu li {
  margin-bottom: 15px;
}
.sidebar-menu li a {
  color: #fff;
  text-decoration: none;
  font-weight: 600;
  padding: 10px 15px;
  display: block;
  border-radius: 8px;
  transition: background 0.3s;
}
.sidebar-menu li a.active,
.sidebar-menu li a:hover {
  background-color: #fff;
  color: #ff3b3b;
}

/* Main Content */
.dashboard-main {
  flex: 1;
  padding: 30px;
  background-color: #f5f5f5;
}

/* Cards */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}
.card {
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: center;
}
.card-red {
  background-color: #ff3b3b;
  color: #fff;
}
.card-white {
  background-color: #fff;
  color: #333;
}

/* Market Actions */
.market-actions {
  display: flex;
  gap: 20px;
  margin-bottom: 40px;
}
.action-card {
  flex: 1;
  background-color: #fff;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: center;
}
.action-card h4 {
  margin-bottom: 10px;
}
.btn {
  display: inline-block;
  padding: 10px 25px;
  margin-top: 15px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  transition: background 0.3s;
  cursor: pointer;
}
.btn-red {
  background-color: #ff3b3b;
  color: #fff;
}
.btn-red:hover {
  background-color: #e12d2d;
}

/* Transactions Table */
.transactions-section {
  background-color: #fff;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  margin-bottom: 30px;
}
.transactions-table {
  width: 100%;
  border-collapse: collapse;
}
.transactions-table th,
.transactions-table td {
  padding: 12px 15px;
  text-align: left;
}
.transactions-table th {
  background-color: #ff3b3b;
  color: #fff;
}
.transactions-table tr:nth-child(even) {
  background-color: #f9f9f9;
}
.transactions-table tr:hover {
  background-color: #ffe5e5;
}

/* Music Player */
.music-player {
  background-color: #fff;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  margin-top: 20px;
}

@media(max-width: 768px) {
  .dashboard-container {
    flex-direction: column;
  }
  .dashboard-sidebar {
    width: 100%;
    flex-direction: row;
    overflow-x: auto;
  }
  .dashboard-sidebar ul {
    display: flex;
    flex-direction: row;
  }
  .dashboard-sidebar li {
    margin: 0 10px;
  }
  .cards-grid {
    grid-template-columns: 1fr;
  }
  .market-actions {
    flex-direction: column;
  }
}
</style>

{% endblock %}
